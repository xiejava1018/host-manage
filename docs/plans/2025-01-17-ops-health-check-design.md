# è¿ç»´å¥åº·æ£€æŸ¥ Skill è®¾è®¡æ–‡æ¡£

**åˆ›å»ºæ—¥æœŸ**: 2025-01-17
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µ
**ç‰ˆæœ¬**: 1.0

## 1. æ¦‚è¿°

### 1.1 ç›®æ ‡
åˆ›å»ºä¸€ä¸ªç»¼åˆæ€§çš„è¿ç»´å¥åº·æ£€æŸ¥ skillï¼ˆops-health-checkï¼‰ï¼Œç”¨äºè‡ªåŠ¨åŒ–ç›‘æ§å’Œç®¡ç†å¤šå°ä¸»æœºçš„å¥åº·çŠ¶å†µã€‚è¯¥ skill æ”¯æŒåŸºç¡€ç³»ç»Ÿèµ„æºã€Docker ç¯å¢ƒã€æœåŠ¡çŠ¶æ€ã€è¿è¡Œæ—¶ç¯å¢ƒå’Œæ·±åº¦å®‰å…¨æ£€æŸ¥ã€‚

### 1.2 ä½¿ç”¨åœºæ™¯
- æ—¥å¸¸ä¸»æœºå¥åº·å·¡æ£€
- æ‰¹é‡å¤šä¸»æœºç›‘æ§
- Docker å®¹å™¨ç¯å¢ƒæ£€æŸ¥
- æœåŠ¡è¿è¡ŒçŠ¶æ€ç›‘æ§
- å®‰å…¨å¨èƒæ£€æµ‹ï¼ˆæœ¨é©¬ã€æŒ–çŸ¿ã€å‹’ç´¢ç—…æ¯’ï¼‰
- è¿è¡Œæ—¶ç¯å¢ƒéªŒè¯

### 1.3 æ ¸å¿ƒç‰¹æ€§
- é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†å¤šå°ä¸»æœº
- å¹¶è¡Œæ‰§è¡Œå„ç±»æ£€æŸ¥æ¨¡å—
- è‡ªåŠ¨ç”Ÿæˆ Markdown æŠ¥å‘Šå’Œ JSON æ•°æ®
- æ”¯æŒè‡ªå®šä¹‰å‘Šè­¦é˜ˆå€¼
- æ·±åº¦å®‰å…¨æ£€æŸ¥åŠŸèƒ½

## 2. æ•´ä½“æ¶æ„

### 2.1 æŠ€æœ¯æ ˆ
- **é…ç½®ç®¡ç†**: YAML
- **è¿œç¨‹æ‰§è¡Œ**: Bash + SSH
- **æŠ¥å‘Šç”Ÿæˆ**: Python/JavaScript
- **æ•°æ®æ ¼å¼**: Markdown + JSON

### 2.2 å·¥ä½œæµç¨‹

```
1. è¯»å–é…ç½®æ–‡ä»¶ (hosts-config.yaml)
   â†“
2. è§£æä¸»æœºåˆ—è¡¨å’Œæ£€æŸ¥å‚æ•°
   â†“
3. å¹¶è¡Œæ‰§è¡Œæ£€æŸ¥æ¨¡å—
   â”œâ”€ åŸºç¡€ç³»ç»Ÿèµ„æºæ£€æŸ¥
   â”œâ”€ Docker ç¯å¢ƒæ£€æŸ¥
   â”œâ”€ æœåŠ¡çŠ¶æ€æ£€æŸ¥
   â”œâ”€ è¿è¡Œæ—¶ç¯å¢ƒæ£€æŸ¥
   â””â”€ æ·±åº¦å®‰å…¨æ£€æŸ¥
   â†“
4. æ”¶é›†å’Œåˆ†ææ£€æŸ¥ç»“æœ
   â†“
5. æ ¹æ®é˜ˆå€¼åˆ¤æ–­å‘Šè­¦çº§åˆ«
   â”œâ”€ æ­£å¸¸ (âœ…)
   â”œâ”€ è­¦å‘Š (âš ï¸)
   â””â”€ å±é™© (âŒ)
   â†“
6. ç”ŸæˆæŠ¥å‘Šæ–‡ä»¶
   â”œâ”€ Markdown æŠ¥å‘Š (health-reports/)
   â””â”€ JSON æ•°æ® (health-data/)
```

### 2.3 æ–‡ä»¶ç»“æ„

```
host-manage/
â”œâ”€â”€ hosts-config.yaml              # ä¸»æœºé…ç½®æ–‡ä»¶
â”œâ”€â”€ skills/
â”‚   â””â”€â”€ ops-health-check.skill.md  # ä¸»æŠ€èƒ½å®šä¹‰æ–‡ä»¶
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ check-system.sh           # ç³»ç»Ÿèµ„æºæ£€æŸ¥è„šæœ¬
â”‚   â”œâ”€â”€ check-docker.sh           # Docker ç¯å¢ƒæ£€æŸ¥è„šæœ¬
â”‚   â”œâ”€â”€ check-services.sh         # æœåŠ¡çŠ¶æ€æ£€æŸ¥è„šæœ¬
â”‚   â”œâ”€â”€ check-runtime.sh          # è¿è¡Œæ—¶ç¯å¢ƒæ£€æŸ¥è„šæœ¬
â”‚   â”œâ”€â”€ check-security.sh         # å®‰å…¨æ£€æŸ¥è„šæœ¬
â”‚   â””â”€â”€ generate-report.py        # æŠ¥å‘Šç”Ÿæˆè„šæœ¬
â”œâ”€â”€ health-reports/                # Markdown æŠ¥å‘Šè¾“å‡ºç›®å½•
â””â”€â”€ health-data/                   # JSON æ•°æ®è¾“å‡ºç›®å½•
```

## 3. é…ç½®æ–‡ä»¶è®¾è®¡

### 3.1 é…ç½®æ–‡ä»¶ç»“æ„ (hosts-config.yaml)

```yaml
# ä¸»æœºåˆ—è¡¨é…ç½®
hosts:
  - name: "ç”Ÿäº§æœåŠ¡å™¨"
    ip: "192.168.0.42"
    ssh_user: "root"
    ssh_port: 22
    enabled: true

  - name: "æµ‹è¯•æœåŠ¡å™¨"
    ip: "192.168.0.43"
    ssh_user: "admin"
    ssh_port: 22
    enabled: false

# æ£€æŸ¥é˜ˆå€¼é…ç½®
thresholds:
  disk_usage_warning: 50      # ç£ç›˜ä½¿ç”¨ç‡è­¦å‘Šé˜ˆå€¼ï¼ˆ%ï¼‰
  disk_usage_critical: 80     # ç£ç›˜ä½¿ç”¨ç‡ä¸¥é‡é˜ˆå€¼ï¼ˆ%ï¼‰
  memory_usage_warning: 70    # å†…å­˜ä½¿ç”¨ç‡è­¦å‘Šé˜ˆå€¼ï¼ˆ%ï¼‰
  memory_usage_critical: 90   # å†…å­˜ä½¿ç”¨ç‡ä¸¥é‡é˜ˆå€¼ï¼ˆ%ï¼‰
  cpu_load_warning: 2.0       # CPU è´Ÿè½½è­¦å‘Šé˜ˆå€¼
  cpu_load_critical: 5.0      # CPU è´Ÿè½½ä¸¥é‡é˜ˆå€¼

# è¾“å‡ºç›®å½•é…ç½®
output:
  reports_dir: "./health-reports"
  json_dir: "./health-data"

# æ£€æŸ¥é¡¹å¼€å…³
checks:
  system_resources: true
  docker: true
  services: true
  runtime: true
  security: true
```

### 3.2 é…ç½®ç‰¹ç‚¹
- ç®€æ´çš„ YAML æ ¼å¼ï¼Œæ˜“äºç»´æŠ¤
- æ”¯æŒå¤šä¸»æœºé…ç½®å’Œå¯ç”¨/ç¦ç”¨æ§åˆ¶
- å¯è‡ªå®šä¹‰å‘Šè­¦é˜ˆå€¼
- çµæ´»çš„æ£€æŸ¥é¡¹å¼€å…³

## 4. æ£€æŸ¥æ¨¡å—è¯¦ç»†è®¾è®¡

### 4.1 åŸºç¡€ç³»ç»Ÿèµ„æºæ£€æŸ¥

**æ£€æŸ¥é¡¹ç›®**:
- ç³»ç»Ÿè¿è¡Œæ—¶é—´
- CPU è´Ÿè½½ï¼ˆ1/5/15 åˆ†é’Ÿå¹³å‡å€¼ï¼‰
- å†…å­˜ä½¿ç”¨ç‡å’Œ swap ä½¿ç”¨æƒ…å†µ
- ç£ç›˜ç©ºé—´ï¼ˆæ‰€æœ‰æŒ‚è½½ç‚¹ï¼‰
- ç½‘ç»œè¿æ¥ç»Ÿè®¡

**å®ç°æ–¹å¼**:
```bash
# ä½¿ç”¨æ ‡å‡† Linux å‘½ä»¤
- uptime: ç³»ç»Ÿè¿è¡Œæ—¶é—´å’Œè´Ÿè½½
- free: å†…å­˜ä½¿ç”¨æƒ…å†µ
- df: ç£ç›˜ç©ºé—´
- ss/netstat: ç½‘ç»œè¿æ¥
```

**è¾“å‡ºå­—æ®µ**:
```json
{
  "uptime": "55 days, 1:21",
  "load_average": [0.15, 0.30, 0.35],
  "memory": {
    "total_gb": 4.0,
    "used_gb": 1.7,
    "available_gb": 2.3,
    "percent": 42,
    "swap_total_gb": 2.0,
    "swap_used_gb": 0.097,
    "swap_percent": 4.8
  },
  "disk": [
    {
      "filesystem": "GW2T/subvol-102-disk-0",
      "size_gb": 50,
      "used_gb": 13,
      "available_gb": 38,
      "percent": 26,
      "mount_point": "/"
    }
  ],
  "network": {
    "connections": 45,
    "listening_ports": 12
  }
}
```

### 4.2 Docker ç¯å¢ƒæ£€æŸ¥

**æ£€æŸ¥é¡¹ç›®**:
- Docker æœåŠ¡è¿è¡ŒçŠ¶æ€
- è¿è¡Œä¸­å®¹å™¨åˆ—è¡¨åŠçŠ¶æ€
- å®¹å™¨èµ„æºä½¿ç”¨ï¼ˆCPU/å†…å­˜ï¼‰
- Docker é•œåƒå ç”¨ç©ºé—´
- Docker ç½‘ç»œå’Œå·çŠ¶æ€
- å®¹å™¨æ—¥å¿—å¤§å°æ£€æŸ¥

**å®ç°æ–¹å¼**:
```bash
# Docker å‘½ä»¤
- systemctl status docker: æœåŠ¡çŠ¶æ€
- docker ps: å®¹å™¨åˆ—è¡¨
- docker stats: èµ„æºä½¿ç”¨
- docker images: é•œåƒåˆ—è¡¨
- docker network ls: ç½‘ç»œåˆ—è¡¨
- docker volume ls: å·åˆ—è¡¨
```

**è¾“å‡ºå­—æ®µ**:
```json
{
  "service_status": "running",
  "containers": {
    "total": 12,
    "running": 12,
    "stopped": 0
  },
  "container_list": [
    {
      "id": "abc123",
      "name": "nginx",
      "status": "running",
      "cpu_percent": 0.5,
      "memory_usage_mb": 128
    }
  ],
  "images": {
    "total": 15,
    "total_size_gb": 3.2
  },
  "networks": {
    "total": 3
  },
  "volumes": {
    "total": 5
  }
}
```

### 4.3 æœåŠ¡çŠ¶æ€æ£€æŸ¥

**æ£€æŸ¥é¡¹ç›®**:
- systemd æœåŠ¡çŠ¶æ€ï¼ˆfailed/inactive/activeï¼‰
- å¸¸ç”¨æœåŠ¡åˆ—è¡¨ï¼ˆssh, docker, nginx, mysql ç­‰ï¼‰
- æœåŠ¡å¯åŠ¨å¤±è´¥æ—¥å¿—
- å®šæ—¶ä»»åŠ¡ï¼ˆcronï¼‰çŠ¶æ€

**å®ç°æ–¹å¼**:
```bash
# æœåŠ¡æ£€æŸ¥å‘½ä»¤
- systemctl list-units: æœåŠ¡åˆ—è¡¨
- systemctl status <service>: å•ä¸ªæœåŠ¡çŠ¶æ€
- journalctl: æœåŠ¡æ—¥å¿—
- systemctl list-timers: å®šæ—¶ä»»åŠ¡
```

**è¾“å‡ºå­—æ®µ**:
```json
{
  "services": [
    {
      "name": "ssh.service",
      "status": "active",
      "sub_status": "running",
      "description": "OpenBSD Secure Shell server"
    },
    {
      "name": "docker.service",
      "status": "active",
      "sub_status": "running",
      "description": "Docker Application Container Engine"
    }
  ],
  "failed_services": [],
  "cron_jobs": 5
}
```

### 4.4 è¿è¡Œæ—¶ç¯å¢ƒæ£€æŸ¥

**æ£€æŸ¥é¡¹ç›®**:
- Python ç‰ˆæœ¬å’Œ pip çŠ¶æ€
- Node.js ç‰ˆæœ¬å’Œ npm çŠ¶æ€
- Java ç‰ˆæœ¬ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- å¸¸ç”¨åº“ç‰ˆæœ¬ä¿¡æ¯

**å®ç°æ–¹å¼**:
```bash
# è¿è¡Œæ—¶æ£€æŸ¥å‘½ä»¤
- python3 --version: Python ç‰ˆæœ¬
- pip3 --version: pip ç‰ˆæœ¬
- pip3 list: å·²å®‰è£…åŒ…åˆ—è¡¨
- node --version: Node.js ç‰ˆæœ¬
- npm --version: npm ç‰ˆæœ¬
- java -version: Java ç‰ˆæœ¬
```

**è¾“å‡ºå­—æ®µ**:
```json
{
  "python": {
    "installed": true,
    "version": "3.12.3",
    "executable": "/usr/bin/python3",
    "pip_installed": false,
    "common_packages": {
      "numpy": false,
      "pandas": false,
      "requests": false
    }
  },
  "nodejs": {
    "installed": false
  },
  "java": {
    "installed": false
  }
}
```

### 4.5 æ·±åº¦å®‰å…¨æ£€æŸ¥

#### 4.5.1 å¼‚å¸¸è¿›ç¨‹æ£€æµ‹

**æ£€æŸ¥é¡¹ç›®**:
- CPU/å†…å­˜å ç”¨å¼‚å¸¸é«˜çš„è¿›ç¨‹
- å·²çŸ¥æŒ–çŸ¿ç¨‹åºåï¼ˆxmrig, minerd, cpuminer ç­‰ï¼‰
- å¯ç–‘è¿›ç¨‹åï¼ˆéšæœºå­—ç¬¦ä¸²ã€éšè—å­—ç¬¦ï¼‰
- è¿›ç¨‹å¯åŠ¨è·¯å¾„æ˜¯å¦åœ¨å¯ç–‘ç›®å½•ï¼ˆ/tmp, /dev/shmï¼‰

**å®ç°æ–¹å¼**:
```bash
# è¿›ç¨‹æ£€æŸ¥å‘½ä»¤
- ps aux: è¿›ç¨‹åˆ—è¡¨
- top/htop: èµ„æºå ç”¨
- lsof: è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶
```

**è¾“å‡ºå­—æ®µ**:
```json
{
  "suspicious_processes": [],
  "high_resource_processes": [
    {
      "pid": 1234,
      "name": "process-name",
      "cpu_percent": 85,
      "memory_percent": 12,
      "user": "root"
    }
  ],
  "mining_processes": [],
  "tmp_executables": []
}
```

#### 4.5.2 å¯ç–‘ç½‘ç»œè¿æ¥

**æ£€æŸ¥é¡¹ç›®**:
- åå‘ shell è¿æ¥ï¼ˆå¤–éƒ¨ IP è¿æ¥æœ¬åœ°é«˜ç«¯å£ï¼‰
- æ‰€æœ‰ç›‘å¬ç«¯å£å’Œå¤–éƒ¨è¿æ¥
- è¿æ¥åˆ°å·²çŸ¥æ¶æ„ IP æˆ–éå¸¸è§„ç«¯å£
- å¼‚å¸¸å»ºç«‹çš„ SSH è¿æ¥

**å®ç°æ–¹å¼**:
```bash
# ç½‘ç»œæ£€æŸ¥å‘½ä»¤
- ss -tulpn: ç½‘ç»œè¿æ¥
- netstat -ant: æ‰€æœ‰è¿æ¥
- lsof -i: ç½‘ç»œè¿æ¥è¯¦ç»†ä¿¡æ¯
```

**è¾“å‡ºå­—æ®µ**:
```json
{
  "suspicious_connections": [],
  "external_connections": 8,
  "listening_ports": [
    {
      "port": 22,
      "protocol": "tcp",
      "process": "sshd"
    }
  ],
  "reverse_shell_indicators": []
}
```

#### 4.5.3 æ–‡ä»¶ç³»ç»Ÿå®‰å…¨

**æ£€æŸ¥é¡¹ç›®**:
- æœ€è¿‘ 24 å°æ—¶ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆé‡ç‚¹ç›®å½•ï¼‰
- /tmp å’Œ /dev/shm ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶
- å¯ç–‘æ–‡ä»¶åï¼ˆéšè—æ–‡ä»¶ã€éšæœºåç§°ï¼‰
- ç”¨æˆ·ç›®å½•ä¸‹çš„ .ssh é…ç½®å˜æ›´
- å‹’ç´¢ç—…æ¯’ç‰¹å¾æ–‡ä»¶

**å®ç°æ–¹å¼**:
```bash
# æ–‡ä»¶æ£€æŸ¥å‘½ä»¤
- find: æŸ¥æ‰¾æ–‡ä»¶
- ls -la: æ–‡ä»¶è¯¦æƒ…
- stat: æ–‡ä»¶å…ƒæ•°æ®
```

**è¾“å‡ºå­—æ®µ**:
```json
{
  "recently_modified_files": [
    {
      "path": "/tmp/suspicious.exe",
      "modified": "2025-01-17T08:30:00",
      "size_kb": 1024
    }
  ],
  "tmp_executables": [],
  "ransomware_indicators": [],
  "ssh_changes": []
}
```

#### 4.5.4 è´¦æˆ·å’Œç™»å½•å®‰å…¨

**æ£€æŸ¥é¡¹ç›®**:
- æœ€è¿‘æˆåŠŸç™»å½•è®°å½•
- å¤±è´¥ç™»å½•å°è¯•ç»Ÿè®¡
- æ–°å¢ç”¨æˆ·è´¦æˆ·æ£€æŸ¥
- sudo æ—¥å¿—å¼‚å¸¸
- å…³é”®æ–‡ä»¶æƒé™éªŒè¯

**å®ç°æ–¹å¼**:
```bash
# ç™»å½•æ£€æŸ¥å‘½ä»¤
- last: ç™»å½•è®°å½•
- lastb: å¤±è´¥ç™»å½•
- w: å½“å‰ç™»å½•ç”¨æˆ·
- cat /etc/passwd: ç”¨æˆ·åˆ—è¡¨
- sudo -l: sudo æƒé™
```

**è¾“å‡ºå­—æ®µ**:
```json
{
  "recent_logins": [
    {
      "user": "root",
      "ip": "192.168.0.100",
      "time": "2025-01-17T09:00:00"
    }
  ],
  "failed_logins": 3,
  "new_users": [],
  "sudo_logs": []
}
```

#### 4.5.5 ç³»ç»Ÿå®Œæ•´æ€§

**æ£€æŸ¥é¡¹ç›®**:
- SUID/SGID å¯æ‰§è¡Œæ–‡ä»¶åˆ—è¡¨
- ç³»ç»Ÿå…³é”®äºŒè¿›åˆ¶æ–‡ä»¶æ ¡éªŒå’Œ
- /etc ç›®å½•ä¸‹é…ç½®æ–‡ä»¶å˜æ›´

**å®ç°æ–¹å¼**:
```bash
# å®Œæ•´æ€§æ£€æŸ¥å‘½ä»¤
- find / -perm -4000: SUID æ–‡ä»¶
- find / -perm -2000: SGID æ–‡ä»¶
- md5sum/sha256sum: æ–‡ä»¶æ ¡éªŒå’Œ
```

**è¾“å‡ºå­—æ®µ**:
```json
{
  "suid_files": [
    "/usr/bin/sudo",
    "/usr/bin/passwd"
  ],
  "sgid_files": [],
  "config_changes": [],
  "binary_checksums": []
}
```

## 5. è¾“å‡ºæ ¼å¼è®¾è®¡

### 5.1 Markdown æŠ¥å‘Šæ ¼å¼

```markdown
# ä¸»æœºå¥åº·æ£€æŸ¥æŠ¥å‘Š

**æ£€æŸ¥æ—¶é—´**: 2025-01-17 09:53:30
**ä¸»æœº**: 192.168.0.42 (ç”Ÿäº§æœåŠ¡å™¨)
**æ£€æŸ¥è€—æ—¶**: 3.2ç§’

## ğŸ“Š æ€»ä½“çŠ¶æ€
- ç³»ç»Ÿèµ„æº: âœ… æ­£å¸¸
- Docker: âœ… æ­£å¸¸
- æœåŠ¡: âš ï¸ 1ä¸ªè­¦å‘Š
- è¿è¡Œæ—¶: âŒ Python pipæœªå®‰è£…
- å®‰å…¨: âœ… æ­£å¸¸

## ğŸ’» ç³»ç»Ÿèµ„æº

### CPU & å†…å­˜
- è¿è¡Œæ—¶é—´: 55å¤© 1å°æ—¶21åˆ†
- è´Ÿè½½: 0.15, 0.30, 0.35
- å†…å­˜: 1.7GB / 4.0GB (42%)
- Swap: 97MB / 2.0GB (4.8%)

### ç£ç›˜ç©ºé—´
| æ–‡ä»¶ç³»ç»Ÿ | å®¹é‡ | å·²ç”¨ | å¯ç”¨ | ä½¿ç”¨ç‡ | çŠ¶æ€ |
|---------|------|------|------|--------|------|
| /       | 50G  | 13G  | 38G  | 26%    | âœ…   |

## ğŸ³ Docker ç¯å¢ƒ
- è¿è¡Œä¸­å®¹å™¨: 12ä¸ª
- DockeræœåŠ¡: âœ… è¿è¡Œä¸­
- é•œåƒæ€»æ•°: 15ä¸ª
- ç½‘ç»œ: 3ä¸ª
- å·: 5ä¸ª

### å®¹å™¨åˆ—è¡¨
| å®¹å™¨å | çŠ¶æ€ | CPU% | å†…å­˜ä½¿ç”¨ |
|--------|------|------|---------|
| nginx  | âœ…   | 0.5  | 128MB   |
| mysql  | âœ…   | 2.1  | 512MB   |

## ğŸ”§ æœåŠ¡çŠ¶æ€
| æœåŠ¡åç§° | çŠ¶æ€ | æè¿° |
|---------|------|------|
| ssh.service | âœ… è¿è¡Œä¸­ | OpenBSD Secure Shell server |
| docker.service | âœ… è¿è¡Œä¸­ | Docker Application Container Engine |
| cron.service | âœ… è¿è¡Œä¸­ | Regular background program processing daemon |

## ğŸ è¿è¡Œæ—¶ç¯å¢ƒ
- Python 3.12.3: âœ… å·²å®‰è£…
- pip: âŒ æœªå®‰è£…
- Node.js: âŒ æœªå®‰è£…
- Java: âŒ æœªå®‰è£…

## ğŸ”’ å®‰å…¨æ£€æŸ¥

### å¼‚å¸¸è¿›ç¨‹
- âœ… æœªå‘ç°æŒ–çŸ¿ç¨‹åº
- âœ… æœªå‘ç°å¯ç–‘è¿›ç¨‹
- âš ï¸ 1ä¸ªé«˜èµ„æºå ç”¨è¿›ç¨‹

### ç½‘ç»œè¿æ¥
- å¤–éƒ¨è¿æ¥: 8ä¸ª
- ç›‘å¬ç«¯å£: 12ä¸ª
- âœ… æœªå‘ç°åå‘shell

### æ–‡ä»¶ç³»ç»Ÿ
- âœ… /tmp ä¸­æ— å¯ç–‘å¯æ‰§è¡Œæ–‡ä»¶
- âœ… æœªå‘ç°å‹’ç´¢ç—…æ¯’ç‰¹å¾
- âœ… .ssh é…ç½®æ— å¼‚å¸¸å˜æ›´

### ç™»å½•å®‰å…¨
- æœ€è¿‘ç™»å½•: 3æ¬¡æˆåŠŸ
- å¤±è´¥å°è¯•: 3æ¬¡
- âœ… æ— æ–°å¢å¯ç–‘ç”¨æˆ·

### ç³»ç»Ÿå®Œæ•´æ€§
- SUID æ–‡ä»¶: 2ä¸ªï¼ˆæ­£å¸¸ï¼‰
- âœ… ç³»ç»Ÿå…³é”®æ–‡ä»¶å®Œæ•´æ€§æ­£å¸¸

---
**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-01-17 09:53:33
**æ£€æŸ¥å·¥å…·**: ops-health-check v1.0
```

### 5.2 JSON æ•°æ®æ ¼å¼

```json
{
  "timestamp": "2025-01-17T09:53:30Z",
  "host": {
    "name": "ç”Ÿäº§æœåŠ¡å™¨",
    "ip": "192.168.0.42"
  },
  "check_duration_seconds": 3.2,
  "summary": {
    "overall_status": "warning",
    "checks_total": 5,
    "checks_passed": 3,
    "checks_warning": 1,
    "checks_failed": 1,
    "status_by_category": {
      "system_resources": "passed",
      "docker": "passed",
      "services": "warning",
      "runtime": "failed",
      "security": "passed"
    }
  },
  "system_resources": {
    "uptime": "55 days, 1:21",
    "load_average": [0.15, 0.30, 0.35],
    "memory": {
      "total_gb": 4.0,
      "used_gb": 1.7,
      "available_gb": 2.3,
      "percent": 42,
      "swap_total_gb": 2.0,
      "swap_used_gb": 0.097,
      "swap_percent": 4.8
    },
    "disk": [
      {
        "filesystem": "GW2T/subvol-102-disk-0",
        "size_gb": 50,
        "used_gb": 13,
        "available_gb": 38,
        "percent": 26,
        "mount_point": "/"
      }
    ],
    "network": {
      "connections": 45,
      "listening_ports": 12
    }
  },
  "docker": {
    "service_status": "running",
    "containers": {
      "total": 12,
      "running": 12,
      "stopped": 0
    },
    "container_list": [
      {
        "id": "abc123",
        "name": "nginx",
        "status": "running",
        "cpu_percent": 0.5,
        "memory_usage_mb": 128
      }
    ],
    "images": {
      "total": 15,
      "total_size_gb": 3.2
    },
    "networks": {
      "total": 3
    },
    "volumes": {
      "total": 5
    }
  },
  "services": {
    "services": [
      {
        "name": "ssh.service",
        "status": "active",
        "sub_status": "running",
        "description": "OpenBSD Secure Shell server"
      },
      {
        "name": "docker.service",
        "status": "active",
        "sub_status": "running",
        "description": "Docker Application Container Engine"
      }
    ],
    "failed_services": [],
    "cron_jobs": 5
  },
  "runtime": {
    "python": {
      "installed": true,
      "version": "3.12.3",
      "executable": "/usr/bin/python3",
      "pip_installed": false,
      "common_packages": {
        "numpy": false,
        "pandas": false,
        "requests": false
      }
    },
    "nodejs": {
      "installed": false
    },
    "java": {
      "installed": false
    }
  },
  "security": {
    "suspicious_processes": [],
    "high_resource_processes": [
      {
        "pid": 1234,
        "name": "process-name",
        "cpu_percent": 85,
        "memory_percent": 12,
        "user": "root"
      }
    ],
    "mining_processes": [],
    "tmp_executables": [],
    "suspicious_connections": [],
    "external_connections": 8,
    "listening_ports": [
      {
        "port": 22,
        "protocol": "tcp",
        "process": "sshd"
      }
    ],
    "reverse_shell_indicators": [],
    "recently_modified_files": [],
    "ransomware_indicators": [],
    "ssh_changes": [],
    "recent_logins": [
      {
        "user": "root",
        "ip": "192.168.0.100",
        "time": "2025-01-17T09:00:00"
      }
    ],
    "failed_logins": 3,
    "new_users": [],
    "sudo_logs": [],
    "suid_files": ["/usr/bin/sudo", "/usr/bin/passwd"],
    "sgid_files": [],
    "config_changes": []
  }
}
```

## 6. é”™è¯¯å¤„ç†ç­–ç•¥

### 6.1 SSH è¿æ¥å¤±è´¥
- è®°å½•å¤±è´¥ä¸»æœºåˆ°æŠ¥å‘Š
- æ ‡è®°ä¸º "âŒ æ— æ³•è¿æ¥"
- ç»§ç»­æ£€æŸ¥å…¶ä»–ä¸»æœº
- è®°å½•é”™è¯¯è¯¦æƒ…

### 6.2 å‘½ä»¤æ‰§è¡Œå¤±è´¥
- æ•è·é”™è¯¯ä¿¡æ¯
- åœ¨æŠ¥å‘Šä¸­æ ‡æ³¨ "âš ï¸ æ£€æŸ¥å¤±è´¥"
- è®°å½•åŸå§‹é”™è¯¯æ¶ˆæ¯
- ä¸å½±å“å…¶ä»–æ£€æŸ¥é¡¹

### 6.3 è¶…æ—¶å¤„ç†
- æ¯ä¸ªæ£€æŸ¥è®¾ç½®è¶…æ—¶ï¼ˆ30ç§’ï¼‰
- è¶…æ—¶åè·³è¿‡è¯¥æ£€æŸ¥é¡¹
- æ ‡è®°ä¸º "â±ï¸ æ£€æŸ¥è¶…æ—¶"
- è®°å½•è¶…æ—¶æ—¶é—´

### 6.4 éƒ¨åˆ†æ£€æŸ¥å¤±è´¥
- å…¶ä»–æ£€æŸ¥ç»§ç»­æ‰§è¡Œ
- æœ€ç»ˆæŠ¥å‘Šæ ‡æ³¨å“ªäº›æ£€æŸ¥å¤±è´¥
- ä¸å½±å“æ•´ä½“æ£€æŸ¥æµç¨‹
- æä¾›å¤±è´¥åŸå› å’Œå»ºè®®

## 7. å‘Šè­¦çº§åˆ«å®šä¹‰

### 7.1 çº§åˆ«åˆ†ç±»

**æ­£å¸¸ (âœ… passed)**
- æ‰€æœ‰æŒ‡æ ‡åœ¨æ­£å¸¸èŒƒå›´å†…
- æ— å®‰å…¨å¨èƒ
- æœåŠ¡è¿è¡Œæ­£å¸¸

**è­¦å‘Š (âš ï¸ warning)**
- éƒ¨åˆ†æŒ‡æ ‡è¶…è¿‡è­¦å‘Šé˜ˆå€¼
- å­˜åœ¨æ½œåœ¨é—®é¢˜
- ä¸å½±å“ç³»ç»Ÿè¿è¡Œ

**ä¸¥é‡ (âŒ failed/critical)**
- å…³é”®æŒ‡æ ‡è¶…è¿‡ä¸¥é‡é˜ˆå€¼
- å­˜åœ¨å®‰å…¨å¨èƒ
- æœåŠ¡å¼‚å¸¸æˆ–åœæ­¢

### 7.2 é˜ˆå€¼é…ç½®

é»˜è®¤é˜ˆå€¼ï¼ˆå¯åœ¨é…ç½®æ–‡ä»¶ä¸­è‡ªå®šä¹‰ï¼‰ï¼š
- ç£ç›˜ä½¿ç”¨ç‡: è­¦å‘Š 50%, ä¸¥é‡ 80%
- å†…å­˜ä½¿ç”¨ç‡: è­¦å‘Š 70%, ä¸¥é‡ 90%
- CPU è´Ÿè½½: è­¦å‘Š 2.0, ä¸¥é‡ 5.0
- Swap ä½¿ç”¨: è­¦å‘Š 30%, ä¸¥é‡ 50%

## 8. å®ç°è®¡åˆ’

### 8.1 å®ç°é˜¶æ®µ

**é˜¶æ®µ 1: åŸºç¡€æ¡†æ¶**
- åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„
- å®ç°é…ç½®æ–‡ä»¶è§£æ
- å®ç°åŸºç¡€ SSH è¿æ¥å’Œå‘½ä»¤æ‰§è¡Œ

**é˜¶æ®µ 2: æ£€æŸ¥æ¨¡å—**
- å®ç°ç³»ç»Ÿèµ„æºæ£€æŸ¥
- å®ç° Docker ç¯å¢ƒæ£€æŸ¥
- å®ç°æœåŠ¡çŠ¶æ€æ£€æŸ¥
- å®ç°è¿è¡Œæ—¶ç¯å¢ƒæ£€æŸ¥
- å®ç°æ·±åº¦å®‰å…¨æ£€æŸ¥

**é˜¶æ®µ 3: æŠ¥å‘Šç”Ÿæˆ**
- å®ç° Markdown æŠ¥å‘Šç”Ÿæˆ
- å®ç° JSON æ•°æ®è¾“å‡º
- å®ç°å‘Šè­¦åˆ¤æ–­é€»è¾‘

**é˜¶æ®µ 4: é›†æˆå’Œæµ‹è¯•**
- åˆ›å»º Skill å®šä¹‰æ–‡ä»¶
- é›†æˆæ‰€æœ‰æ¨¡å—
- åœ¨å®é™…ç¯å¢ƒä¸­æµ‹è¯•
- ä¼˜åŒ–å’Œå®Œå–„

### 8.2 ä¾èµ–å·¥å…·

è¿œç¨‹ä¸»æœºéœ€è¦å®‰è£…çš„å·¥å…·ï¼š
- æ ‡å‡†Linuxå‘½ä»¤ï¼ˆbash, awk, sed, grepï¼‰
- systemdï¼ˆæœåŠ¡ç®¡ç†ï¼‰
- Dockerï¼ˆå¦‚æœéœ€è¦æ£€æŸ¥Dockerï¼‰

æœ¬åœ°ç¯å¢ƒï¼š
- Python 3.6+
- pyyamlï¼ˆé…ç½®æ–‡ä»¶è§£æï¼‰
- SSH å®¢æˆ·ç«¯

## 9. ä½¿ç”¨ç¤ºä¾‹

### 9.1 é…ç½®ä¸»æœº

```yaml
# hosts-config.yaml
hosts:
  - name: "ç”Ÿäº§æœåŠ¡å™¨"
    ip: "192.168.0.42"
    ssh_user: "root"
    enabled: true
```

### 9.2 æ‰§è¡Œæ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰å¯ç”¨çš„ä¸»æœº
/health-check

# æ£€æŸ¥æŒ‡å®šä¸»æœº
/health-check --host 192.168.0.42

# åªæ‰§è¡Œç‰¹å®šæ£€æŸ¥
/health-check --check security
```

### 9.3 æŸ¥çœ‹æŠ¥å‘Š

```bash
# Markdown æŠ¥å‘Š
cat health-reports/192.168.0.42-2025-01-17.md

# JSON æ•°æ®
cat health-data/192.168.0.42-2025-01-17.json
```

## 10. æœªæ¥æ‰©å±•

### 10.1 å¯èƒ½çš„å¢å¼ºåŠŸèƒ½
- Web ç•Œé¢å±•ç¤º
- å†å²è¶‹åŠ¿åˆ†æ
- é‚®ä»¶/é’‰é’‰/ä¼å¾®å‘Šè­¦é€šçŸ¥
- è‡ªåŠ¨ä¿®å¤åŠŸèƒ½
- å®šæ—¶ä»»åŠ¡è°ƒåº¦
- ç›‘æ§æ•°æ®æŒä¹…åŒ–
- å›¾è¡¨å¯è§†åŒ–

### 10.2 æ€§èƒ½ä¼˜åŒ–
- å¹¶è¡Œæ£€æŸ¥å¤šå°ä¸»æœº
- ç¼“å­˜æ£€æŸ¥ç»“æœ
- å¢é‡æ£€æŸ¥æ¨¡å¼
- æ£€æŸ¥ç»“æœå‹ç¼©

## 11. å®‰å…¨è€ƒè™‘

### 11.1 SSH å¯†é’¥ç®¡ç†
- æ”¯æŒ SSH å¯†é’¥è®¤è¯
- å¯†é’¥æƒé™æ£€æŸ¥
- å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆå¦‚æœä½¿ç”¨å¯†ç ï¼‰

### 11.2 æ•æ„Ÿä¿¡æ¯ä¿æŠ¤
- ä¸åœ¨æŠ¥å‘Šä¸­æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯
- æ—¥å¿—è„±æ•å¤„ç†
- å®‰å…¨çš„é…ç½®æ–‡ä»¶å­˜å‚¨

### 11.3 æƒé™æ§åˆ¶
- æœ€å°æƒé™åŸåˆ™
- sudo ä½¿ç”¨è°¨æ…
- å®¡è®¡æ—¥å¿—è®°å½•

## 12. é™„å½•

### 12.1 æœ¯è¯­è¡¨
- **SUID**: Set User IDï¼Œæ–‡ä»¶æƒé™ä½
- **SGID**: Set Group IDï¼Œæ–‡ä»¶æƒé™ä½
- **rootkit**: æ¶æ„è½¯ä»¶å·¥å…·åŒ…
- **å‹’ç´¢ç—…æ¯’**: åŠ å¯†ç”¨æˆ·æ•°æ®çš„æ¶æ„è½¯ä»¶

### 12.2 å‚è€ƒèµ„æº
- Linux ç³»ç»Ÿç®¡ç†æœ€ä½³å®è·µ
- Docker å®˜æ–¹æ–‡æ¡£
- systemd æœåŠ¡ç®¡ç†æ–‡æ¡£
- OpenSSH é…ç½®æŒ‡å—

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-01-17
**ä½œè€…**: Claude Code + ç”¨æˆ·åä½œè®¾è®¡
